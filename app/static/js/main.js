(()=>{function p(){return localStorage.getItem("gameId")}function y(e){localStorage.setItem("gameId",e)}function l(){let e=new URLSearchParams(window.location.search).id;return e||(e=p(),e||(e=crypto.randomUUID(),y(e)),e)}function m(e,t){if(!t)return;let n=new WebSocket(`ws://localhost:8080/ws?id=${e}`);n.onopen=()=>{console.log("connected")},n.onclose=()=>{console.log("disconnected")},n.addEventListener("message",a=>{let o=JSON.parse(a.data);if(!o.type||!o.data){console.error("ERROR: wrong message format");return}switch(o.type){case"Lobby":h(t,o.data,e,n);break;case"Track":f(t,o.data,n);break;default:break}})}function f(e,t,n){e.innerHTML=t,g(".starting-position-option","ActionChooseStartingPosition",n),g(".player-option","ActionMakeMove",n)}function h(e,t,n,a){e.innerHTML=t;let o=document.getElementById("invite-button");o&&o.addEventListener("click",()=>{navigator.clipboard.writeText(`${document.location.host}?id=${n}`)});let r=document.getElementById("change-name-button"),c=document.getElementById("change-name-input");r&&c&&r.addEventListener("click",()=>{let i=c.value;if(i.length===0||i.length>20)return;let u=d("ActionNameChange",i);a.send(u),c.value=""});let s=document.getElementById("start-button");s&&s.addEventListener("click",()=>{let i=d("ActionToggleReady");a.send(i)})}function g(e,t,n){document.querySelectorAll(e)?.forEach(a=>{let[o,r]=a.id.split("-"),[c,s]=r.split(",");a.addEventListener("click",()=>{if(n&&a.className.length>0){let i=d(t,{x:parseInt(c),y:parseInt(s)});n.send(i)}})})}function d(e,t){return JSON.stringify({type:e,data:t})}function b(){let e=l(),t=document.getElementById("content");m(e,t)}b();})();
