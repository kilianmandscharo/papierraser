(()=>{function v(){return localStorage.getItem("gameId")}function S(e){localStorage.setItem("gameId",e)}function y(){let e=new URLSearchParams(window.location.search).id;return e||(e=v(),e||(e=crypto.randomUUID(),S(e)),e)}function A(e,o){if(!o)return;let n=new WebSocket(`ws://localhost:8080/ws?id=${e}`);n.onopen=()=>{console.log("connected")},n.onclose=()=>{console.log("disconnected")},n.addEventListener("message",c=>{let t=JSON.parse(c.data);if(!t.type||!t.data){console.error("ERROR: wrong message format");return}switch(t.type){case"ClientActionLobby":I(o,t.data,e,n);break;case"ClientActionTrack":E(o,t.data,n);break;case"ClientActionMove":f(JSON.parse(t.data),n);break;default:break}})}function f(e,o){document.querySelectorAll(".player-option")?.forEach(u=>{u.remove()});let{point:n,playerId:c}=e,t=document.getElementById(`player-${c}`),l=document.getElementById("canvas");if(!t||!l)return;var i=document.createElementNS("http://www.w3.org/2000/svg","line");let a=t.getAttribute("cx")??"",r=t.getAttribute("cy")??"",s=t.getAttribute("fill")??"";console.log(a,r,s),i.setAttribute("x1",a),i.setAttribute("y1",r),i.setAttribute("x2",a),i.setAttribute("y2",r),i.setAttribute("stroke",s),l.appendChild(i),h(t,i,n.x*5,n.y*5,500,()=>{o.send(m("ServerActionMoveAnimationDone"))})}function h(e,o,n,c,t,l){let i=performance.now(),a=parseFloat(e.getAttribute("cx")||"0"),r=parseFloat(e.getAttribute("cy")||"0");function s(u){let d=Math.min((u-i)/t,1),g=(a+(n-a)*d).toString(),p=(r+(c-r)*d).toString();e.setAttribute("cx",g),e.setAttribute("cy",p),o.setAttribute("x2",g),o.setAttribute("y2",p),d<1?requestAnimationFrame(s):l()}requestAnimationFrame(s)}function E(e,o,n){e.innerHTML=o,b(".starting-position-option","ServerActionChooseStartingPosition",n),b(".player-option","ServerActionMakeMove",n)}function I(e,o,n,c){e.innerHTML=o;let t=document.getElementById("invite-button");t&&t.addEventListener("click",()=>{navigator.clipboard.writeText(`${document.location.host}?id=${n}`)});let l=document.getElementById("change-name-button"),i=document.getElementById("change-name-input");l&&i&&l.addEventListener("click",()=>{let r=i.value;if(r.length===0||r.length>20)return;let s=m("ServerActionNameChange",r);c.send(s),i.value=""});let a=document.getElementById("start-button");a&&a.addEventListener("click",()=>{let r=m("ServerActionToggleReady");c.send(r)})}function b(e,o,n){document.querySelectorAll(e)?.forEach(c=>{let t=c,[l,i]=t.id.split("-"),[a,r]=i.split(",");t.addEventListener("click",()=>{if(n&&t.classList.length>0){let s=m(o,{x:parseInt(a),y:parseInt(r)});n.send(s)}})})}function m(e,o){return JSON.stringify({type:e,data:o})}function k(){let e=y(),o=document.getElementById("content");A(e,o)}k();})();
