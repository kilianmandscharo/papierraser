(()=>{function f(){return localStorage.getItem("gameId")}function h(e){localStorage.setItem("gameId",e)}function u(){let e=new URLSearchParams(window.location.search).id;return e||(e=f(),e||(e=crypto.randomUUID(),h(e)),e)}function p(e,o){if(!o)return;let t=new WebSocket(`ws://localhost:8080/ws?id=${e}`);t.onopen=()=>{console.log("connected")},t.onclose=()=>{console.log("disconnected")},t.addEventListener("message",a=>{let n=JSON.parse(a.data);if(!n.type||!n.data){console.error("ERROR: wrong message format");return}switch(n.type){case"Lobby":E(o,n.data,e,t);break;case"Track":I(o,n.data,t);break;case"Move":S(JSON.parse(n.data),t);break;default:break}})}function S(e,o){document.querySelectorAll(".player-option")?.forEach(c=>{c.remove()});let{point:t,playerId:a}=e,n=document.getElementById(`player-${a}`);n&&v(n,t.x*5,t.y*5,500,()=>{console.log("done"),o.send(d("ActionMoveAnimationDone"))})}function v(e,o,t,a,n){let c=performance.now(),r=parseFloat(e.getAttribute("cx")||"0"),s=parseFloat(e.getAttribute("cy")||"0");function i(l){let m=Math.min((l-c)/a,1),y=r+(o-r)*m,b=s+(t-s)*m;e.setAttribute("cx",y.toString()),e.setAttribute("cy",b.toString()),m<1?requestAnimationFrame(i):n()}requestAnimationFrame(i)}function I(e,o,t){e.innerHTML=o,g(".starting-position-option","ActionChooseStartingPosition",t),g(".player-option","ActionMakeMove",t)}function E(e,o,t,a){e.innerHTML=o;let n=document.getElementById("invite-button");n&&n.addEventListener("click",()=>{navigator.clipboard.writeText(`${document.location.host}?id=${t}`)});let c=document.getElementById("change-name-button"),r=document.getElementById("change-name-input");c&&r&&c.addEventListener("click",()=>{let i=r.value;if(i.length===0||i.length>20)return;let l=d("ActionNameChange",i);a.send(l),r.value=""});let s=document.getElementById("start-button");s&&s.addEventListener("click",()=>{let i=d("ActionToggleReady");a.send(i)})}function g(e,o,t){document.querySelectorAll(e)?.forEach(a=>{let n=a,[c,r]=n.id.split("-"),[s,i]=r.split(",");n.addEventListener("click",()=>{if(t&&n.classList.length>0){let l=d(o,{x:parseInt(s),y:parseInt(i)});t.send(l)}})})}function d(e,o){return JSON.stringify({type:e,data:o})}function k(){let e=u(),o=document.getElementById("content");p(e,o)}k();})();
